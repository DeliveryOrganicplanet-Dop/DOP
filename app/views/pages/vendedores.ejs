<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendedores - DOP</title>
    <link rel="stylesheet" href="css/vendedores.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="top-bar">
        <a href="/" class="back">
            <span class="back-icon">&#10094;</span>
        </a>
        <h1 class="logo">Nossos Vendedores</h1>
    </header>

    <main class="vendedores-container">
        <section class="hero-section">
            <h2>Conhe√ßa Nossos Parceiros</h2>
            <p>Produtores locais comprometidos com qualidade e sustentabilidade</p>
        </section>

        <section class="vendedores-grid">
            <% vendedores.forEach(vendedor => { %>
                <article class="vendedor-card">
                    <header class="vendedor-avatar">
                        <span class="avatar-icon">üë®‚Äçüåæ</span>
                    </header>
                    <section class="vendedor-info">
                        <h3 class="vendedor-nome"><%= vendedor.NOME_USUARIO %></h3>
                        <p class="vendedor-tipo">
                            <%= vendedor.tipo_pessoa === 'PF' ? 'Pessoa F√≠sica' : 'Pessoa Jur√≠dica' %>
                        </p>
                        <p class="vendedor-documento">
                            <%= vendedor.tipo_pessoa === 'PF' ? 'CPF' : 'CNPJ' %>: 
                            <%= vendedor.digito_pessoa %>
                        </p>
                        <address class="vendedor-localizacao">
                            <span class="location-icon">üìç</span>
                            <%= vendedor.CIDADE_USUARIO %> - <%= vendedor.UF_USUARIO %>
                        </address>
                        <address class="vendedor-contato">
                            <span class="phone-icon">üìû</span>
                            <%= vendedor.CELULAR_USUARIO %>
                        </address>
                        <aside class="vendedor-stats">
                            <figure class="stat">
                                <span class="stat-number"><%= vendedor.media_avaliacao || '0.0' %></span>
                                <figcaption class="stat-label">‚≠ê Avalia√ß√£o (<%= vendedor.total_avaliacoes || 0 %>)</figcaption>
                            </figure>
                            <figure class="stat">
                                <span class="stat-number">2024</span>
                                <figcaption class="stat-label">üìÖ Desde</figcaption>
                            </figure>
                        </aside>
                        <button class="btn-contatar" onclick="contatarVendedor('<%= vendedor.EMAIL_USUARIO %>', '<%= vendedor.NOME_USUARIO %>')">
                            Entrar em Contato
                        </button>
                        <% if (usuario) { %>
                        <button class="btn-avaliar" onclick="avaliarVendedor(<%= vendedor.id_vendedores %>, '<%= vendedor.NOME_USUARIO %>')" style="background:#ff9800; margin-top:8px;">
                            Avaliar Vendedor
                        </button>
                        <% } %>
                    </section>
                </article>
            <% }); %>
        </section>

        <section class="cta-section">
            <article class="cta-content">
                <h3>Quer se tornar um vendedor?</h3>
                <p>Junte-se √† nossa rede de produtores org√¢nicos</p>
                <button class="btn-cadastrar-vendedor" onclick="cadastrarVendedor()">
                    Cadastrar como Vendedor
                </button>
            </article>
        </section>
    </main>

    <script>
        function contatarVendedor(email, nome) {
            window.location.href = `mailto:${email}?subject=Contato - ${nome}`;
        }
        
        function cadastrarVendedor() {
            window.location.href = '/conta';
        }
        
        function avaliarVendedor(idVendedor, nomeVendedor) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; max-width: 400px; width: 90%;">
                    <h3>Avaliar ${nomeVendedor}</h3>
                    <div style="margin: 15px 0;">
                        <label>Nota (1-5):</label>
                        <div id="rating" style="font-size: 24px; margin: 10px 0;">
                            <span onclick="setRating(1)" style="cursor: pointer;">‚≠ê</span>
                            <span onclick="setRating(2)" style="cursor: pointer;">‚≠ê</span>
                            <span onclick="setRating(3)" style="cursor: pointer;">‚≠ê</span>
                            <span onclick="setRating(4)" style="cursor: pointer;">‚≠ê</span>
                            <span onclick="setRating(5)" style="cursor: pointer;">‚≠ê</span>
                        </div>
                    </div>
                    <div style="margin: 15px 0;">
                        <label>Coment√°rio (opcional):</label>
                        <textarea id="comentario" style="width: 100%; height: 60px; margin-top: 5px;"></textarea>
                    </div>
                    <div style="text-align: right;">
                        <button onclick="fecharModal()" style="margin-right: 10px; padding: 8px 16px;">Cancelar</button>
                        <button onclick="enviarAvaliacao(${idVendedor})" style="background: #4CAF50; color: white; padding: 8px 16px; border: none; border-radius: 4px;">Enviar</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
            window.selectedRating = 0;
        }
        
        function setRating(rating) {
            window.selectedRating = rating;
            const stars = document.querySelectorAll('#rating span');
            stars.forEach((star, index) => {
                star.style.opacity = index < rating ? '1' : '0.3';
            });
        }
        
        function fecharModal() {
            if (window.currentModal) {
                document.body.removeChild(window.currentModal);
                window.currentModal = null;
            }
        }
        
        async function enviarAvaliacao(idVendedor) {
            if (window.selectedRating === 0) {
                alert('Por favor, selecione uma nota.');
                return;
            }
            
            const comentario = document.getElementById('comentario').value;
            
            try {
                const response = await fetch('/api/avaliar-vendedor', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id_vendedor: idVendedor,
                        nota: window.selectedRating,
                        comentario: comentario
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Avalia√ß√£o enviada com sucesso!');
                    location.reload();
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch (error) {
                alert('Erro ao enviar avalia√ß√£o');
            }
            
            fecharModal();
        }
    </script>
    <script src="js/vendedores.js"></script>
</body>
</html>