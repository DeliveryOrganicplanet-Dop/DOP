<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Conta - DOP</title>
    <link rel="stylesheet" href="/css/conta.css">
</head>
<body>
    <header>
        <nav>
            <a href="/" class="back-button">&#8249;</a>
            <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
        </nav>
        <figure>
            <img src="/imagens/dopimg.png" alt="DOP Logo" class="logo">
        </figure>
        <h1>Minha Conta</h1>
    </header>

    <main>
        <section class="profile-section">
            <article class="profile-card">
                <header class="profile-header">
                    <figure class="avatar">
                        <div class="avatar-container">
                            <% if (usuario.foto) { %>
                                <img id="userPhoto" src="<%= usuario.foto %>" alt="Foto do usu√°rio" class="user-photo">
                                <div id="avatarCircle" class="avatar-circle" style="display: none;">
                                    <%= usuario.nome.charAt(0).toUpperCase() %>
                                </div>
                            <% } else { %>
                                <img id="userPhoto" src="" alt="Foto do usu√°rio" class="user-photo" style="display: none;">
                                <div id="avatarCircle" class="avatar-circle">
                                    <%= usuario.nome.charAt(0).toUpperCase() %>
                                </div>
                            <% } %>
                            <button class="change-photo-btn" onclick="openPhotoModal()" title="Alterar foto">
                                üì∑
                            </button>
                        </div>
                    </figure>
                    <div class="profile-info">
                        <h2><%= usuario.nome %></h2>
                        <p class="user-type"><%= usuario.tipo === 'C' ? 'Cliente' : usuario.tipo === 'V' ? 'Vendedor' : 'Administrador' %></p>
                    </div>
                </header>
            </article>
        </section>

        <section class="account-details">
            <article class="info-card">
                <header>
                    <h3>Informa√ß√µes Pessoais</h3>
                    <button class="edit-btn" onclick="toggleEdit('personal')">‚úèÔ∏è</button>
                </header>
                <dl class="info-list">
                    <dt>Nome Completo</dt>
                    <dd id="nome-display"><%= usuario.nome %></dd>
                    <dt>Email</dt>
                    <dd id="email-display"><%= usuario.email %></dd>
                    <dt>ID da Conta</dt>
                    <dd><%= usuario.id %></dd>
                </dl>
            </article>

            <article class="info-card">
                <header>
                    <h3>Estat√≠sticas da Conta</h3>
                </header>
                <div class="stats-grid">
                    <div class="stat-item">
                        <data class="stat-number" data-value="0">0</data>
                        <small>Pedidos Realizados</small>
                    </div>
                    <div class="stat-item">
                        <data class="stat-number" data-value="0">R$ 0,00</data>
                        <small>Total Gasto</small>
                    </div>
                    <div class="stat-item">
                        <data class="stat-number" data-value="0">0</data>
                        <small>Dias como Cliente</small>
                    </div>
                </div>
            </article>

            <article class="info-card">
                <header>
                    <h3>Prefer√™ncias</h3>
                </header>
                <div class="preferences">
                    <label class="preference-item">
                        <input type="checkbox" checked>
                        <span>Receber notifica√ß√µes por email</span>
                    </label>
                    <label class="preference-item">
                        <input type="checkbox">
                        <span>Ofertas especiais</span>
                    </label>
                    <label class="preference-item">
                        <input type="checkbox" checked>
                        <span>Lembretes de pedidos</span>
                    </label>
                </div>
            </article>

            <article class="info-card">
                <header>
                    <h3>A√ß√µes da Conta</h3>
                </header>
                <div class="action-buttons">
                    <% if (usuario.tipo === 'V') { %>
                        <a href="/painel-vendedor" class="action-btn primary">
                            üì¶ Gerenciar Produtos
                        </a>
                    <% } else { %>
                        <a href="/carrinho" class="action-btn primary">
                            üõí Ver Carrinho
                        </a>
                    <% } %>
                    <a href="/calendario" class="action-btn secondary">
                        üìÖ Calend√°rio Nutricional
                    </a>
                    <button onclick="openPasswordModal()" class="action-btn tertiary">
                        üîí Redefinir Senha
                    </button>
                    <button onclick="debugPedidos()" class="action-btn" style="background: #ff9800; margin-top: 10px;">
                        üîç Debug Pedidos
                    </button>
                    <button onclick="aprovarUltimoPedido()" class="action-btn" style="background: #4caf50; margin-top: 5px;">
                        ‚úÖ Aprovar √öltimo Pedido
                    </button>
                </div>
            </article>
        </section>

        <footer class="account-footer">
            <button onclick="voltarPaginaInicial()" class="btn-secondary">Voltar ao In√≠cio</button>
            <button onclick="deslogar()" class="btn-danger">Sair da Conta</button>
        </footer>
    </main>

    <dialog id="editModal" class="modal">
        <article class="modal-content">
            <header>
                <h3>Editar Informa√ß√µes</h3>
                <button class="close" onclick="closeEditModal()">&times;</button>
            </header>
            <form id="editForm">
                <fieldset>
                    <label for="editNome">Nome:</label>
                    <input type="text" id="editNome" value="<%= usuario.nome %>">
                    
                    <label for="editEmail">Email:</label>
                    <input type="email" id="editEmail" value="<%= usuario.email %>">
                </fieldset>
                <footer>
                    <button type="button" onclick="closeEditModal()">Cancelar</button>
                    <button type="submit">Salvar</button>
                </footer>
            </form>
        </article>
    </dialog>

    <dialog id="passwordModal" class="modal">
        <article class="modal-content">
            <header>
                <h3>Redefinir Senha</h3>
                <button class="close" onclick="closePasswordModal()">&times;</button>
            </header>
            <form id="passwordForm">
                <fieldset>
                    <label for="currentPassword">Senha Atual:</label>
                    <input type="password" id="currentPassword" required>
                    
                    <label for="newPassword">Nova Senha:</label>
                    <input type="password" id="newPassword" required minlength="6">
                    
                    <label for="confirmPassword">Confirmar Nova Senha:</label>
                    <input type="password" id="confirmPassword" required minlength="6">
                    
                    <div class="password-strength">
                        <div class="strength-bar">
                            <div id="strengthIndicator" class="strength-fill"></div>
                        </div>
                        <small id="strengthText">Digite uma senha</small>
                    </div>
                </fieldset>
                <footer>
                    <button type="button" onclick="closePasswordModal()">Cancelar</button>
                    <button type="submit">Alterar Senha</button>
                </footer>
            </form>
        </article>
    </dialog>

    <dialog id="photoModal" class="modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000;">
        <article class="modal-content" style="background: white; margin: 2% auto; padding: 20px; border-radius: 8px; max-width: 600px; max-height: 90vh; overflow-y: auto;">
            <header>
                <h3>Alterar Foto de Perfil</h3>
                <button class="close" onclick="closePhotoModal()" style="float: right; background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
            </header>
            <div class="photo-options">
                <div class="upload-area" style="text-align: center; padding: 20px; border: 2px dashed #ddd; margin: 20px 0; border-radius: 8px;">
                    <input type="file" id="photoInput" name="photo" accept="image/*" style="display: none;">
                    <button type="button" onclick="document.getElementById('photoInput').click()" class="upload-btn" style="padding: 10px 20px; margin: 10px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        üìÅ Escolher Arquivo
                    </button>
                    <p>ou</p>
                    <button type="button" onclick="openCamera()" class="camera-btn" style="padding: 10px 20px; margin: 10px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        üì∑ Usar C√¢mera
                    </button>
                </div>
                
                <div class="photo-preview" id="photoPreview" style="display: none; text-align: center;">
                    <div class="crop-container" style="margin: 20px 0;">
                        <canvas id="cropCanvas" width="200" height="200" style="border: 2px solid #ddd; border-radius: 50%; cursor: move; margin: 10px auto; display: block;"></canvas>
                        <div class="crop-controls" style="margin: 20px 0;">
                            <label style="display: block; margin: 10px 0;">Zoom: <input type="range" id="zoomSlider" min="1" max="3" step="0.1" value="1" style="width: 200px;"></label>
                            <label style="display: block; margin: 10px 0;">Rota√ß√£o: <input type="range" id="rotateSlider" min="0" max="360" step="1" value="0" style="width: 200px;"></label>
                        </div>
                    </div>
                    <div class="preview-actions" style="margin: 20px 0;">
                        <button type="button" onclick="savePhoto()" class="save-photo-btn" style="padding: 10px 20px; margin: 5px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar Foto</button>
                        <button type="button" onclick="removePhoto()" class="remove-photo-btn" style="padding: 10px 20px; margin: 5px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">Remover Foto</button>
                        <button type="button" onclick="resetCrop()" class="reset-crop-btn" style="padding: 10px 20px; margin: 5px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer;">Resetar</button>
                    </div>
                </div>
            </div>
        </article>
    </dialog>

    <script src="/js/conta.js"></script>
</body>
</html>
